- name: Send Test Execution Email
  if: always()
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.gmail.com
    server_port: 587
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: "API Automation Test Report – Build #${{ github.run_number }}"
    to: ${{ secrets.EMAIL_TO }}
    from: "API Automation CI"

    html_body: |
      <h3>API Automation Execution Summary</h3>
      <table border="1" cellpadding="6">
        <tr>
          <th>Total</th>
          <th>Failures</th>
          <th>Skipped</th>
        </tr>
        <tr>
          <td>${{ env.TOTAL }}</td>
          <td>${{ env.FAILURES }}</td>
          <td>${{ env.SKIPPED }}</td>
        </tr>
      </table>

      <br/>
      <b>Reports:</b>
      <ul>
        <li>Cucumber HTML – Attached</li>
        <li>
          ChainTest –
          <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">
            Download from Artifacts
          </a>
        </li>
      </ul>

      <br/>
      Regards,<br/>
      CI Automation Pipeline

    attachments: "target/cucumber-html-reports/index.html"